{
  "id": "339e24b0-e13a-4c71-a8fe-fc4bfabd96d8",
  "jobName": "Fatura",
  "selectSql": "WITH base AS (\n  SELECT\n    src.*,\n    NULLIF(src.idmedicaodetalhe, 0) AS idmedicaodetalhe_norm,\n    src.ctid\n  FROM fatura src\n),\nranked AS (\n  SELECT\n    b.*,\n    row_number() OVER (\n      PARTITION BY b.idmedicaodetalhe_norm\n      ORDER BY b.id DESC   -- \"mais novo\": troque se seu crit√©rio for data/campo diferente\n    ) AS rn\n  FROM base b\n)\nselect\n  src.id AS id,\n  true AS calculo_realizado,\n  null AS codigo_barras,\n  to_date(nullif(src.datacancelamento,''),'YYYYMMDD') data_cancelamento,\n  to_date(nullif(src.dataemissaoorigem,''),'YYYYMMDD') data_emissao,\n  to_date(nullif(src.dataestornocancelamento,''),'YYYYMMDD') data_estorno_cancelamento,\n  to_date(nullif(src.datapagto,''),'YYYYMMDD') data_pagamento,\n  to_date(nullif(src.datapagtoprovisorio,''),'YYYYMMDD') data_pagamento_provisorio,\n  to_date(nullif(src.datavencimento,''),'YYYYMMDD') data_vencimento,\n  to_date(nullif(src.datavencimentooriginal,''),'YYYYMMDD') data_vencimento_original,\n  src.email AS email,\n  case when src.enviado = 'S' then true else false end AS enviado_debito_automatico,\n  case when src.enviadofaturaemail = 'S' then true else false end as enviado_fatura_email,\n  case when src.faturaemitida = 'S' then true else false end as fatura_emitida,\n  case when src.negativada = 'S' then true else false end as fatura_negativada,\n  left(src.declaracaoquitacaoanual,255) AS mensagem_declaracao_quitacao_anual,\n  '' AS mensagem_fatura,\n  src.nremissoes AS numero_emissoes,\n  src.valor AS valor_fatura,\n  src.idclienteinquilino AS id_cliente_inquilino,\n  src.idtipocobranca  AS id_cobranca_tipo,\n  src.idtipoentrega AS id_entrega_tipo,\n  src.idfaturamotivocancto AS id_fatura_motivo_cancelamento,\n  src.idmotivorecalculo AS id_fatura_motivo_recalculo,\n  src.idfaturarecalculada AS id_fatura_recalculada,\n  src.idfaturasituacao AS id_fatura_situacao,\n  src.idtipotransacao AS id_fatura_tipo_transacao,\n  src.idtipofaturamento AS id_faturamento_tipo,\n  src.idgrupo AS id_grupo_medicao,\n  src.idligacao AS id_ligacao_imovel,\n  CASE\n  WHEN src.idmedicaodetalhe_norm IS NULL THEN NULL\n  WHEN src.rn \u003c\u003e 1 THEN NULL\n  WHEN NOT EXISTS (\n    SELECT 1\n    FROM medicaodetalhe md\n    WHERE md.id = src.idmedicaodetalhe_norm\n  ) THEN NULL\n  ELSE src.idmedicaodetalhe_norm\nEND AS id_medicao_detalhe,\n  src.idparctobaixa AS id_parcelamento_baixa,\n  src.idperiodo AS id_periodo\nFROM ranked src",
  "insertSql": "INSERT INTO\n  ${SCHEMA}.fatura (\n    id,\n    calculo_realizado,\n    codigo_barras,\n    data_cancelamento,\n    data_emissao,\n    data_estorno_cancelamento,\n    data_pagamento,\n    data_pagamento_provisorio,\n    data_vencimento,\n    data_vencimento_original,\n    email,\n    enviado_debito_automatico,\n    enviado_fatura_email,\n    fatura_emitida,\n    fatura_negativada,\n    mensagem_declaracao_quitacao_anual,\n    mensagem_fatura,\n    numero_emissoes,\n    valor_fatura,\n    id_cliente_inquilino,\n    id_cobranca_tipo,\n    id_entrega_tipo,\n    id_fatura_motivo_cancelamento,\n    id_fatura_motivo_recalculo,\n    id_fatura_recalculada,\n    id_fatura_situacao,\n    id_fatura_tipo_transacao,\n    id_faturamento_tipo,\n    id_grupo_medicao,\n    id_ligacao_imovel,\n    id_medicao_detalhe,\n    id_parcelamento_baixa,\n    id_periodo\n  )",
  "columns": [
    "id",
    "calculo_realizado",
    "codigo_barras",
    "data_cancelamento",
    "data_emissao",
    "data_estorno_cancelamento",
    "data_pagamento",
    "data_pagamento_provisorio",
    "data_vencimento",
    "data_vencimento_original",
    "email",
    "enviado_debito_automatico",
    "enviado_fatura_email",
    "fatura_emitida",
    "fatura_negativada",
    "mensagem_declaracao_quitacao_anual",
    "mensagem_fatura",
    "numero_emissoes",
    "valor_fatura",
    "id_cliente_inquilino",
    "id_cobranca_tipo",
    "id_entrega_tipo",
    "id_fatura_motivo_cancelamento",
    "id_fatura_motivo_recalculo",
    "id_fatura_recalculada",
    "id_fatura_situacao",
    "id_fatura_tipo_transacao",
    "id_faturamento_tipo",
    "id_grupo_medicao",
    "id_ligacao_imovel",
    "id_medicao_detalhe",
    "id_parcelamento_baixa",
    "id_periodo"
  ],
  "primaryKeys": null,
  "recordsPerPage": 1000,
  "type": "insert",
  "stopOnError": true,
  "left": 1300,
  "top": 6600
}